<?xml version="1.0"?>
<!DOCTYPE fontconfig SYSTEM "urn:fontconfig:fonts.dtd">
<fontconfig>

	<!--
        TODO: denylist for Unicode emoji codepoints for any font that
		isn't und-zsye. There's an emoji sequence file here.
		https://unicode.org/Public/emoji/15.0/emoji-sequences.txt

        Should be relatively straightforward to write a Perl script that
        extracts the codepoints (they're in hex) and formats them in a
        similar way to what's mentioned here.
		https://stackoverflow.com/questions/47501411/how-to-set-font-per-unicode-range-codepoint-in-fontconfig

        I'm hoping that the performance is reasonable because I really
        don't know how I'm going to do this otherwise.
	-->

	<!-- Font settings for all fonts -->
	<match target="font">
		<edit name="embeddedbitmap" mode="assign"><bool>false</bool></edit>
		<edit name="antialias" mode="assign"><bool>true</bool></edit>
		<edit name="autohint" mode="assign"><bool>false</bool></edit>
		<edit name="hinting" mode="assign"><bool>true</bool></edit>
		<edit name="hintstyle" mode="assign"><const>hintslight</const></edit>
		<edit name="rgba" mode="assign"><const>rgb</const></edit>
		<edit name="lcdfilter" mode="assign"><const>lcddefault</const></edit>
	</match>

	<selectfont>
		<!-- Reject certain types of fonts. -->
		<rejectfont>

			<!-- Reject black and white emoji fonts. -->
			<pattern>
				<patelt name="lang">
					<string>und-zsye</string>
				</patelt>
				<patelt name="color">
					<bool>false</bool>
				</patelt>
			</pattern>
			<pattern>
				<patelt name="family">
					<string>emoji</string>
				</patelt>
				<patelt name="color">
					<bool>false</bool>
				</patelt>
			</pattern>

			<!--
			Reject DejaVu family. They override emojis.
			NOTE: is there a better way to match these?
			-->
			<pattern>
				<patelt name="family">
					<string>DejaVu Serif</string>
				</patelt>
			</pattern>
			<pattern>
				<patelt name="family">
					<string>DejaVu Sans</string>
				</patelt>
			</pattern>
			<pattern>
				<patelt name="family">
					<string>DejaVu Sans Mono</string>
				</patelt>
			</pattern>
			<pattern>
				<patelt name="family">
					<string>DejaVu Math TeX Gyre</string>
				</patelt>
			</pattern>

		</rejectfont>
	</selectfont>

	<!-- emoji -->
	<match>
		<test name="family"><string>emoji</string></test>
		<edit name="family" mode="prepend_first" binding="strong">
			<string>Twemoji Mozilla</string>
		</edit>
	</match>

	<!-- serif -->
	<match>
		<test name="family"><string>serif</string></test>
		<edit name="family" mode="prepend_first">
			<string>Liberation Serif</string>
			<string>Noto Serif</string>
		</edit>
	</match>

	<!-- sans-serif -->
	<match>
		<test name="family"><string>sans-serif</string></test>
		<edit name="family" mode="prepend_first">
			<string>Liberation Sans</string>
			<string>Noto Sans</string>
		</edit>
	</match>

	<!-- monospace -->
	<match>
		<test name="family"><string>monospace</string></test>
		<edit name="family" mode="prepend_first">
			<string>Iosevka</string>
		</edit>
	</match>

</fontconfig>

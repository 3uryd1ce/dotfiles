#!/usr/bin/env perl

# Called by sxiv(1) whenever an image gets loaded.
# The output is displayed in sxiv's status bar.
# Arguments:
#   $1: path to image file
#   $2: image width
#   $3: image height

# TODO:
# Review Number::Bytes::Human to see exactly how it does what it does.

use v5.32;
use autodie;
use strict;
use warnings;

use File::Basename qw(fileparse);
use Number::Bytes::Human qw(format_bytes);

my $operating_system = $^O;

if ( $operating_system eq 'openbsd' ) {
	use OpenBSD::Pledge;
	use OpenBSD::Unveil;

	pledge(qw(rpath unveil)) or die "Pledge failed: $!\n";
}

my $filename = shift or die "Need a file name.\n";

if ( $operating_system eq 'openbsd' ) {
	unveil( $filename, 'r' ) or die "Unveil failed: $!\n";
	pledge(qw(rpath)) or die "Pledge failed: $!\n";
}

my $basename = fileparse $filename;

my $width = shift or die "Need a width.\n";
my $height = shift or die "Need a height.\n";
my $geometry = $width . 'x' . $height;

my $file_size = format_bytes( ( stat $filename )[7] );
my $separator = ' | ';

print $file_size . $separator . $geometry . $separator . $basename;

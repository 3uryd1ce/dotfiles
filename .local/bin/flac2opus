#!/usr/bin/env sh
set -e

sec_print () {
  printf "%s\\n" "$@"
}

err () {
  sec_print "[$(date +'%Y-%m-%d--%H:%M:%S')]: $*" >&2
  exit 1
}

# encodes all flac files in ${PWD} to opus with parallelization
flac2opus () {
  parallel opusenc --bitrate 192 "{}" "{.}.opus" ::: ./*.flac
}

flac2opus || err "Unable to convert files properly."

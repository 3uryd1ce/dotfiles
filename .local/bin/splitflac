#!/usr/bin/env sh
set -e

# dependencies:
#   - cuetools
#   - shntool

err() {
  sec_print "[$(date +'%Y-%m-%d|%H:%M:%S')]: $*" >&2
  exit 1
}

# usage
# splitflac [cue file] [FLAC file]
splitflac() {
  shnsplit -f "${1}" -o flac -t "%n %t" "${2}" \
    || err "Unable to split the FLAC file."
  mv "${2}" "${2}.bak"
  cuetag "${1}" ./*.flac || err "Unable to tag FLAC files."
  rm "${2}.bak"
}

splitflac "$@"

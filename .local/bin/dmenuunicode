#!/usr/bin/env sh
# shellcheck disable=SC1090,SC2154

# rewrite of Luke Smith's dmenuunicode:
# https://github.com/LukeSmithxyz/voidrice/blob/master/.local/bin/dmenuunicode

# his dotfiles can be accessed here:
# https://github.com/LukeSmithxyz/voidrice

# check that the library file is readable. if it is, source it so its
# functions are available. if not, exit due to potentially unpredictable
# behavior.
readonly library="${HOME}/.local/bin/common.sh"
if [ -r "${library}" ]; then
  . "${library}"
else
  cat >&2 -- <<EOF
${library} doesn't exist or isn't readable.
${0##*/} may not function correctly without it; exiting for safety.
EOF
  exit 1
fi

grab_emoji() {
  readonly emoji_file="${HOME}/.local/share/emoji"
  [ -r "${emoji_file}" ] || err "Emoji file isn't available."

  readonly chosen="$(cut -d ';' -f1 -- "${emoji_file}" | menu -l 20)"
  [ -n "${chosen}" ] || err 'Must choose an emoji.'
  grep -q -- "^${chosen}" "${emoji_file}" || err 'Emoji not found.'

  # important to use printf %s here, as ${chosen} is user input
  if printf '%s' "${chosen%% *}" | yank; then
    notify-send -- "${chosen%% *} copied to clipboard."
  else
    err 'Unable to grab emoji.'
  fi
}

prereqs() {
  check_grafix
  check_deps <<'EOF'
dmenu
notify-send
EOF
  import_colors
}

main() { prereqs; grab_emoji; sleep 10 && clear_clip notify; }; main

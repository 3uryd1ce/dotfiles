#!/usr/bin/env sh
set -e

emoji_file="${HOME}/.local/share/emoji"

sec_print () {
  printf "%s\\n" "$@"
}

err () {
  sec_print "[$(date +'%Y-%m-%d--%H:%M:%S')]: $*" >&2
  exit 1
}

import_colors () {
  . "${HOME}/.cache/wal/colors.sh"
}

menu () {
  dmenu -i -l 20 \
    -fn "mono-22" \
    -nb "${color0}" \
    -nf "${color3}" \
    -sb "${color0}" \
    -sf "${color7}"
}

process_emoji () {
  chosen=$(cut -d ';' -f1 "${emoji_file}" | menu)

  [ -z "${chosen}" ] && err "Nothing was selected."

  emoji=$(printf "%s" "${chosen}" | sed "s/ .*//")
}

grab_emoji () {
  printf "%s" "${emoji}" | xclip -selection clipboard
}

dmenuunicode () {
  import_colors || err "Unable to import colors."
  process_emoji || err "Unable to process emoji."
  grab_emoji || err "Unable to copy emoji to clipboard."
}

dmenuunicode

#!/usr/bin/env sh
DATE="$(date '+%Y-%m-%d')"
EXTENSION=".dump.bz2"
COMPRESSOR="bzip2"
COMPRESSOR_ARGS="-c"

bkup() {
/sbin/dump -0 -a -u -f - / | "${COMPRESSOR}" ${COMPRESSOR_ARGS} > /mnt/"${DATE}"/root"${EXTENSION}" &
/sbin/dump -0 -a -u -f - /var | "${COMPRESSOR}" ${COMPRESSOR_ARGS} > /mnt/"${DATE}"/var"${EXTENSION}" &
/sbin/dump -0 -a -u -f - /home | "${COMPRESSOR}" ${COMPRESSOR_ARGS} > /mnt/"${DATE}"/home"${EXTENSION}" &
/sbin/dump -0 -a -u -f - /usr/local | "${COMPRESSOR}" ${COMPRESSOR_ARGS} > /mnt/"${DATE}"/usr-local"${EXTENSION}" &
/sbin/dump -0 -a -u -f - /usr/X11R6 | "${COMPRESSOR}" ${COMPRESSOR_ARGS} > /mnt/"${DATE}"/usr-X11R6"${EXTENSION}" &
/sbin/dump -0 -a -u -f - /usr | "${COMPRESSOR}" ${COMPRESSOR_ARGS} > /mnt/"${DATE}"/usr"${EXTENSION}" &
wait
}

intro () {
banner "bkup"
cat <<EOF

This script creates level 0 dumps of /root, /var, /home, /usr/local, /usr/X11R6,
and /usr. It compresses them using ${COMPRESSOR} and places the backups inside
/mnt in a folder named the current date. Is this acceptable?
EOF
read -r CONTINUE

if [ "${CONTINUE}" = "n" ];
then
  printf "Goodbye.\\n"
elif [ "${CONTINUE}" = "y" ];
then
  printf "Dumping filesystems...\\n"
  mkdir -p "/mnt/${DATE}"
  bkup && printf "Filesystem dump complete!\\n"
else
  printf "You must answer with 'y' or 'n'."
  exit
fi
}

intro

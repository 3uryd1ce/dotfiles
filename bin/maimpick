#!/usr/bin/env ksh
set -e

# rewrite of Luke Smith's maimpick
# his dotfiles can be accessed here: https://github.com/LukeSmithxyz/voidrice

# Import the colors
. "${HOME}/.cache/wal/colors.sh"

COMMON_MAIM_ARGS="-d 1 -u -q -B"
DOWNLOADS="${HOME}/Downloads"

menu () {
  dmenu -fn 'mono-20' \
    -nb "${color0}" \
    -nf "${color3}" \
    -sb "${color0}" \
    -sf "${color7}" \
    -l 6 \
    -p 'Screenshot which area?'
}

print_options () {
cat <<EOF
a selected area
current window
full screen
selected area (copy)
current window (copy)
full screen (copy)
EOF
}

cur_date () {
  date '+%Y%m%d-%H%M%S'
}

yank () {
  xclip -selection clipboard -t image/png
}

maim_sel_save () {
  FILENAME="selected-$(cur_date).png"
  maim ${COMMON_MAIM_ARGS} -s "${DOWNLOADS}/${FILENAME}"
}

maim_sel_copy () {
  maim ${COMMON_MAIM_ARGS} -s | yank
}

maim_cur_save () {
  FILENAME="window-$(cur_date).png"
  maim ${COMMON_MAIM_ARGS} -i "$(xdotool getactivewindow)" \
    "${DOWNLOADS}/${FILENAME}"
}

maim_cur_copy () {
  maim ${COMMON_MAIM_ARGS} -i "$(xdotool getactivewindow)" \
    | yank
}

maim_full_save () {
  FILENAME="full-$(cur_date).png"
  maim ${COMMON_MAIM_ARGS} "${DOWNLOADS}/${FILENAME}"
}

maim_full_copy () {
  maim ${COMMON_MAIM_ARGS} | yank
}

case "$(print_options | menu)" in
  "a selected area") maim_sel_save ;;
  "current window") maim_cur_save ;;
  "full screen") maim_full_save ;;
  "a selected area (copy)") maim_sel_copy ;;
  "current window (copy)") maim_cur_copy ;;
  "full screen (copy)") maim_full_copy ;;
esac
